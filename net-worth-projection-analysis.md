# Net Worth Projection Widget - Monte Carlo Algorithm Analysis

## üîç **Research Summary: Net Worth Projection Widget Data Sources & Algorithm**

Based on comprehensive codebase analysis, here are the findings on whether the Net Worth Projection widget uses the same Monte Carlo retirement algorithm as the Retirement Confidence Score widget:

## ‚úÖ **Same Monte Carlo Algorithm - CONFIRMED**

### **Both Widgets Use Identical Monte Carlo Engine:**
- **API Endpoint**: Both call `POST /api/calculate-retirement-monte-carlo`
- **Monte Carlo Function**: `runRightCapitalStyleMonteCarloSimulation(params, 1000)`
- **Location**: `server/monte-carlo-enhanced.ts:2501+`
- **Iterations**: Exactly 1000 simulations for both widgets
- **Parameters**: Generated by identical `profileToRetirementParams()` function

### **Algorithm Characteristics:**
- **Return Model**: Log-normal random returns with expected return and volatility
- **Sequence-of-Returns Risk**: Explicitly modeled year-over-year
- **Real Dollar Model**: Expenses and contributions constant in today's purchasing power
- **Inflation Handling**: Built into the real-dollar modeling approach
- **Tax Treatment**: Simplified annual tax calculations included

## üìä **Net Worth Projection Widget - Median Calculation CONFIRMED**

### **Retirement Assets Projection Method:**
**Location**: `client/src/components/net-worth-projection-widget.tsx:245-274`

```typescript
// Calculate median retirement assets for each age
const ageMedians: { [key: number]: number } = {};

trials.forEach((trial: any) => {
  if (trial.yearlyData) {
    trial.yearlyData.forEach((yearData: any) => {
      const age = yearData.age;
      // Collect portfolioValue for each age across all 1000 trials
    });
  }
});

// Calculate actual medians for each age
Object.keys(ageMedians).forEach(ageStr => {
  const age = parseInt(ageStr);
  const values: number[] = [];
  
  trials.forEach((trial: any) => {
    const yearData = trial.yearlyData?.find((y: any) => y.age === age);
    if (yearData) {
      values.push(yearData.portfolioValue);  // Portfolio value from Monte Carlo
    }
  });
  
  values.sort((a, b) => a - b);
  ageMedians[age] = values[Math.floor(values.length * 0.5)] || 0;  // MEDIAN CALCULATION
});

// Total net worth combines median retirement assets + real estate projections
const totalNetWorth = retirementAssets + netRealEstate;
```

## üè† **Real Estate Treatment - Key Difference**

### **Real Estate Calculation (NOT from Monte Carlo):**
- **Real Estate Growth**: 4.3% nominal annual growth (hardcoded)
- **Applied to**: Full property value (home + additional properties)  
- **Mortgage Reduction**: Simplified linear reduction (40% of payment = principal)
- **Net Real Estate**: `projectedValue - remainingMortgage`

### **Total Net Worth Formula:**
```
Total Net Worth = Median Retirement Assets (from Monte Carlo) + Net Real Estate (deterministic)
```

## üìã **Data Sources Used - Complete Intake Form Integration**

### **Monte Carlo Parameters Include:**
‚úÖ **Retirement Withdrawals**: `expectedMonthlyExpensesRetirement` from intake form  
‚úÖ **Expected Returns**: Risk-based returns by owner (user/spouse/joint assets)  
‚úÖ **Inflation**: Built into real-dollar modeling  
‚úÖ **Sequence of Returns Risk**: Log-normal random returns each year  
‚úÖ **Social Security**: Benefit amounts and claiming ages  
‚úÖ **Guaranteed Income**: Pensions, annuities, part-time retirement income  
‚úÖ **Current Assets**: All retirement account balances  
‚úÖ **Savings Contributions**: Pre-retirement contribution rates  
‚úÖ **Tax Rates**: Simplified tax modeling included  
‚úÖ **Life Expectancy**: Profile-derived longevity assumptions  

## ‚è∞ **Age Projections - Current Age to Life Expectancy**

### **Projection Timeline:**
- **Start Age**: Current age from profile (`dateOfBirth`)
- **End Age**: Life expectancy (typically 93, hardcoded as "longevity age")
- **Display Labels**: Shows "At longevity (93)" not "age 92" as mentioned in requirement
- **Data Points**: Annual projections for every age from current to life expectancy

## üîç **Data Flow Priority (How Widget Gets Data):**

### **Priority 1**: Saved Net Worth Projections
```typescript
if (profile?.netWorthProjections?.projectionData) {
  // Use pre-calculated projection data
}
```

### **Priority 2**: Saved Monte Carlo Results  
```typescript
if (monteCarloData?.retirementSimulation?.results) {
  // Process full Monte Carlo results array for median calculation
}
```

### **Priority 3**: Fresh Monte Carlo Calculation
```typescript
// Call /api/calculate-retirement-monte-carlo for new simulation
```

## ‚ö†Ô∏è **Key Findings**

### **‚úÖ CONFIRMED - Same Algorithm:**
1. **Identical Monte Carlo Engine**: Both widgets use `runRightCapitalStyleMonteCarloSimulation`
2. **Same Parameters**: Both use `profileToRetirementParams()` from same intake data
3. **Median Usage**: Net worth widget correctly uses median across 1000 simulations
4. **Complete Integration**: All retirement-related intake form data is used

### **üîÑ Differences:**
1. **Real Estate**: Added deterministically with 4.3% growth (not Monte Carlo)
2. **Age Target**: Shows "longevity (93)" not "age 92" as requirement states  
3. **Unit Mix**: Combines real-dollar retirement assets with nominal real estate growth

## üéØ **Conclusion**

**YES** - The Net Worth Projection widget uses **exactly the same Monte Carlo retirement algorithm** as the Retirement Confidence Score widget, including:

- Same 1000-iteration Monte Carlo simulation
- Same intake form data integration  
- Same sequence-of-returns risk modeling
- Same expected return, inflation, and withdrawal assumptions
- **Median calculation** correctly applied to retirement assets across all simulations
- Complete projection from current age to life expectancy (93)

The only difference is the addition of deterministic real estate projections, but the retirement assets portion is identical to the confidence score calculation.